# í”„ë¡œë¯¸ìŠ¤ ê°œë…ë¶€í„° í™œìš©ê¹Œì§€

## Promise 

ìžë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ  `ì½œë°±í•¨ìˆ˜ ëŒ€ì‹ ` ë¹„ë™ê¸°ì²˜ë¦¬ë¥¼ ê°„íŽ¸í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìž‡ë„ë¡ ì œê³µí•˜ëŠ” ê°ì²´ì´ë‹¤ (ì•½ì†)

ì •í•´ì§„ ê¸°ëŠ¥ì„ ìˆ˜í–‰í–ˆë‹¤ë©´, ì„±ê³µì˜ ë©”ì‹œì§€ì™€ í•¨ê»˜ ê²°ê³¼ê°’ì„ ë°˜í™˜í•˜ê³ , 
ì²˜ë¦¬í•˜ì§€ ëª»í–ˆì„ ë•Œì—ëŠ” errorë¥¼ ë°˜í™˜í•œë‹¤

> ì˜ˆì‹œ

ì•„ì§ ê°•ì˜ ê°œì„¤í•˜ì§€ëŠ” ì•Šì•˜ì§€ë§Œ, pre-enrollment í•˜ê²Œ ë˜ë©´ Promiseë¥¼ ìƒì„±í•˜ëŠ” ì‹œìŠ¤í…œì´ë‹¤.
ìˆ˜ì—…ì´ ì´ë¯¸ ì˜¤í”ˆëœ ìƒíƒœì—ì„œ ì‚¬ì „ê³µì§€ì°½ì—ì„œ pre-enrollment ë²„íŠ¼ì„ ëˆ„ë¥¸ë‹¤ í•˜ë”ë¼ë„ ì´ë¯¸ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ëœ Promise ì´ê¸° ë•Œë¬¸ì— ë°”ë¡œ ìˆ˜ê°•ì‹ ì²­ì´ ê°€ëŠ¥í•˜ë‹¤


> point

- state : ì§„í–‰ì¤‘ì¸ì§€, ì„±ê³µí–ˆëŠ”ì§€, ì‹¤íŒ¨í–ˆëŠ”ì§€
- ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” producer, ì •ë³´ë¥¼ ì†Œë¹„í•˜ëŠ” consumer

State : pending => fulfilled or rejected
Producer vs Consumer

## 1. Producer

```javascript
// í´ëž˜ìŠ¤ì´ê¸° ë•Œë¬¸ì— new í‚¤ì›Œë“œë¥¼ í†µí•´ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤
// resolve, reject ë‘ ê°€ì§€ì˜ ì½œë°±í•¨ìˆ˜ë¥¼ ì¸ìžë¡œ ê°€ì§„ë‹¤
const promise = new Promise(resolve, reject) => {
  // doing some heavy work (network, read files)
  console.log('doing something...');

  // ì„œë²„ í†µì‹ í•˜ëŠ” ê²ƒì²˜ëŸ¼ setTimeout
  setTimeout(() => resolve('ellie'), 2000);
}
```

Promiseë¥¼ ë§Œë“œëŠ” ìˆœê°„ ì „ë‹¬í•œ resolve, reject ì½œë°±í•¨ìˆ˜ê°€ ë°”ë¡œ ì‹¤í–‰ëœë‹¤.
ë§Œì•½ ì‚¬ìš©ìžê°€ ìš”êµ¬í–ˆì„ ë•Œë§Œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ í•˜ëŠ” ê²½ìš°, ì´ë ‡ê²Œ ì½”ë“œë¥¼ ìž‘ì„±í•˜ë©´ ì‚¬ìš©ìžê°€ ìš”ì²­í•˜ì§€ë„ ì•Šì•˜ëŠ”ë° ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ ë  ê²ƒì´ê¸° ë•Œë¬¸ì— ì£¼ì˜í•´ì•¼ í•œë‹¤

ì§€ê¸ˆì€ ë¹„ë¡ ~~setTimeout() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê¸´ í–ˆì§€ë§Œ,~~ ì„œë²„í†µì‹ ì„ í–ˆì„ ë•Œ ì„±ê³µì ìœ¼ë¡œ ë°›ì•„ì˜¨ ì‘ë‹µê°’ ë° ì‘ë‹µê°’ì„ ê°€ê³µí•œ ë°ì´í„°ë¥¼ resolveí•¨ìˆ˜ì— ì „ë‹¬í•´ì£¼ë©´ ëœë‹¤.

## 2. Consumer
   
### resolve í˜¸ì¶œ

Promiseì—ì„œ ê°’ì„ ìž˜ ê°€ì ¸ì˜¨ë‹¤ë©´ thenì˜ ì½œë°±í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤

```javascript 
const promise = new Promise(resolve, reject) => {
  console.log('doing something...');
  setTimeout(() => resolve('ellie'), 2000);
}

promise.then(value => {
  console.log(value);
})
```

### reject í˜¸ì¶œ

ë§Œì•½ ë„¤íŠ¸ì›Œí¬ë¥¼ í•˜ë‹¤ ì‹¤íŒ¨í•œë‹¤ë©´ error ê°ì²´ë¥¼ í†µí•´ ì „ë‹¬í•œë‹¤

error í´ëž˜ìŠ¤ëŠ” ìžë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì œê³µí•˜ëŠ” ì˜¤ë¸Œì íŠ¸ ì¤‘ í•˜ë‚˜ì´ë‹¤.
ì—ëŸ¬ ì˜¤ë¸Œì íŠ¸ ì‹œê°„ì— ë” ë‹¤ë£¨ê¸°ë¡œ í•˜ê³ , ë³´í†µì€ ì—ëŸ¬ê°€ ë°œìƒí•œ ì´ìœ ì— ëŒ€í•´ ì ëŠ”ë‹¤

ì´ë ‡ê²Œ ë°œìƒí•œ errorì˜ ë‚´ìš©ì„ catch ë©”ì„œë“œì˜ ì½œë°±í•¨ìˆ˜ë¥¼ í†µí•´ í™•ì¸í•  ìˆ˜ ìžˆë‹¤.

```javascript 
const promise = new Promise(resolve, reject) => {
  console.log('doing something...');
  setTimeout(() => reject(new Error('no network')), 2000);
}

promise
  .then(value => {
    console.log(value);
})
  .catch(error => {
    console.log(error);
  })
  .finally(()=> console.log('finally'));
```

ìœ„ì™€ ê°™ì´ thenì„ í˜¸ì¶œí•˜ê²Œ ë˜ë©´ ë‹¤ì‹œ promiseê°€ ë¦¬í„´ë˜ê³ 
ë¦¬í„´ëœ promiseì— catchë¥¼ ë“±ë¡í•˜ê²Œ ëœë‹¤.

promise ì˜¤ë¸Œì íŠ¸ ë‚´ë¶€ì—ëŠ” ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ì‹¶ì€ ì½”ë“œë¥¼ ìž…ë ¥í•˜ê³ ,
ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆë‹¤ë©´ resolveë¥¼ í˜¸ì¶œí•˜ê³ , 
ì‹¤íŒ¨í–ˆë‹¤ë©´ ì‹¤íŒ¨í•œ ì´ìœ ì™€ í•¨ê»˜ reject í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.

finallyëŠ” ì„±ê³µí•˜ë˜ ì‹¤íŒ¨í•˜ë˜ ëª¨ë‘ `ë§ˆì§€ë§‰ìœ¼ë¡œ` í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.

### 3. Promise Chaining

thenì€ ë°”ë¡œ ê°’ì„ ì „ë‹¬í•  ìˆ˜ë„ ìžˆê³  ì•„ë‹ˆë©´ ë¹„ë™ê¸°ì¸ promiseë¥¼ ì „ë‹¬í•  ìˆ˜ë„ ìžˆë‹¤

```javascript
const fetNumber = new Primise(resolve, reject) => {
  setTimeout(() => resolve(1), 1000);
});

fetNumber
.then(num => num * 2) // num = 1
.then(num => num * 3) // num = 2
.then(num => { // num = 6
  return new Promise(resolve, reject) => {
  setTimeout(()=>resolve(num-1), 1000);  // resolve ë§¤ê°œë³€ìˆ˜ 5
  }
});
.then(num => console.log(num)); // 5
// ì´ 2ì´ˆì˜ ì‹œê°„ì´ ê±¸ë¦°ë‹¤ 
```

### 4. ì˜¤ë¥˜ì²˜ë¦¬

> ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆì„ ë•Œì˜ ì½”ë“œ

```javascript
const getHen = () => {
  new Promise((resolve, reject) => {
    setTimeout(() => resolve('hen'), 1000);
  });
};

const getEgg = hen => {
  new Promise((resolve, reject) => {
    setTimeout(() => resolve(`${hen} => egg`), 1000);
  });
};

const cook = egg => {
  new Promise((resolve, reject) => {
    setTimeout(() => resolve(`${egg} => fried egg`), 1000);
  });
}

getHen()
.then(hen => getEgg(hen))
.then(egg => cook(egg))
.then(meal => console.log(meal));

// ì‹¤í–‰ê²°ê³¼ : hen => egg => fried egg
```

> #### ðŸ’¡ ë°›ì•„ì˜¨ í•˜ë‚˜ì˜ valueë¥¼ ì½œë°±í•¨ìˆ˜ì—ì„œ ë§¤ê°œë³€ìˆ˜ë¡œ ë°”ë¡œ ì‚¬ìš©í•  ë•Œ ìƒëžµì´ ê°€ëŠ¥í•˜ë‹¤

```javascript
getHen() // prettier ì—ì„œ í•œì¤„ë¡œ ë˜ê¸° ë•Œë¬¸ì— ì£¼ì„í‘œì‹œë¥¼ í•´ì£¼ë©´ ì—¬ëŸ¬ì¤„ì´ ëœë‹¤
.then(getEgg)
.then(cook)
.then(console.log);
```

> ë§Œì•½ ì—¬ê¸°ì„œ getEgg í•¨ìˆ˜ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤ë©´

```javascript
const getHen = () => {
  new Promise((resolve, reject) => {
    setTimeout(() => resolve('hen'), 1000);
  });
};

const getEgg = hen => {
  new Promise((resolve, reject) => {
    setTimeout(() => reject(new Error(`error! ${hen} => egg`)), 1000);
  });
};

const cook = egg => {
  new Promise((resolve, reject) => {
    setTimeout(() => resolve(`${egg} => fried egg`), 1000);
  });
}

getHen()
.then(getEgg)
.then(cook)
.then(console.log);
```

ì—¬ê¸°ì„œ ì–´ë– í•œ error handlingì„ í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì½˜ì†”ì— `Uncaught (in promise) Error: error! hen => egg at ìœ„ì¹˜`
ì´ë ‡ê²Œ ë°œìƒí•˜ëŠ”ë° ì´ ë•Œ catchë¡œ ì²˜ë¦¬ë¥¼ í•´ì£¼ê²Œ ë˜ë©´ í•´ë‹¹ ë¡œì§ì´ ì‹¤í–‰ëœë‹¤

```javascript
getHen()
.then(getEgg)
.then(cook)
.then(console.log);
.catch(console.log); // ì´ë²ˆê°™ì€ ê²½ìš°ëŠ” console.log
```

ì´ì²˜ëŸ¼ ì—ëŸ¬ê°€ ì œì¼ ë°‘ìœ¼ë¡œ ì „ë‹¬ë˜ë©´ì„œ catchê°€ ìž¡ížŒë‹¤

> ì˜¤ë¥˜ì²˜ë¦¬ : ë‹¬ê±€ì„ ë°›ì•„ì˜¬ ë•Œ ë¬¸ì œê°€ ë°œìƒí–ˆì„ ë•Œ ë‹¤ë¥¸ ìž¬ë£Œë¡œ ëŒ€ì²´í•˜ê³  ì‹¶ì€ ê²½ìš°,

```javascript
getHen()
.then(getEgg)
.catch(error => {  // ì—¬ê¸°!
  return 'bread'
})
.then(cook)
.then(console.log);
.catch(console.log);

// ì‹¤í–‰ê²°ê³¼ : bread => fried edd
```

ì „ë‹¬ë°›ì€ errorë¥¼ breadë¡œ ëŒ€ì²´í•´ì„œ ì „ì²´ì ì¸ promise chainingì— ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ì²˜ë¦¬í•  ìˆ˜ ìžˆë‹¤.

`í•´ë‹¹í•˜ëŠ” ê³³` ì—ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ê³  ì‹¶ì€ ê²½ìš°, ê·¸ ë‹¤ìŒì¤„ì— ë°”ë¡œ catchë¥¼ ì²˜ë¦¬í•˜ë©´ ëœë‹¤

### 5. callback ì§€ì˜¥ -> promise ë³€í™˜

#### ì½œë°±ì§€ì˜¥

```javascript
class UserStorage {
  loginUser(id, password, onSucess, onError) {
    setTimeout(()=>{
      if (
        (id === 'ellie' && password === 'dream') ||
        (id === 'coder' && password === 'academy')
      ) {
        onSucess(id);
      } else {
        onError(new Error('not found'));
      }
    }, 2000)
  }

  getRoles(user, onSuccess, onError) {
    setTimeout(()=> {
      if (user === 'ellie') {
        onSuccess({ name: 'ellie', role: 'admin' });
      } else {
        onError(new Error('no access'));
      }
    }, 1000);
  }
}

const userStorage = new UserStorage();
const id = prompt('enter your id');
const password = promt('enter ypur password');
userStorage.loginUser
(id, 
password, 
user => {
  userStorage.getGRole(
    user, 
    userWithRole => {
      alert(`Hello ${userWithRole.name}, you have a ${userWithRole.role} role.`)
    },
    error => { console.log(error) })
},
error => {
  console.log(error)
  }
);
```

#### Promise ë³€í™˜

```javascript
class UserStorage {
  loginUser(id, password) {
    return new Promise(resolve, reject) => {
      setTimeout(()=>{
        if (
          (id === 'ellie' && password === 'dream') ||
          (id === 'coder' && password === 'academy')
        ) {
          resolve(id);
        } else {
          reject(new Error('not found'));
        }
      }, 2000);
    }
  }

  getRoles(user) {
    return new Promise((resolve, reject) => {
      setTimeout(()=> {
        if (user === 'ellie') {
          onSuccess({ name: 'ellie', role: 'admin' });
        } else {
          onError(new Error('no access'));
        }
      }, 1000);
    })
  }
}

const userStorage = new UserStorage();
const id = prompt('enter your id');
const password = promt('enter ypur password');

userStorage
  .loginUser(id, password)
  .then(userStorage.getRoles)
  .then(user => alert(`Hello ${userWithRole.name}, you have a ${userWithRole.role} role.`)
  .catch(console.log);
```